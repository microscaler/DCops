//! # CRD Generator
//!
//! Generates Kubernetes CustomResourceDefinition (CRD) YAML from Rust type definitions.
//!
//! This binary uses the `kube` crate's `CustomResourceExt` trait to generate
//! the CRD YAML for all DCops resources.
//!
//! ## Usage
//!
//! ```bash
//! # Generate all CRDs
//! cargo run -p crds --bin crdgen > config/crd/all-crds.yaml
//!
//! # Generate and apply directly
//! cargo run -p crds --bin crdgen | kubectl apply -f -
//! ```
//!
//! The generated CRDs include:
//! - OpenAPI schema validation
//! - Required fields
//! - Default values
//! - Status subresources

use crds::ip_claim::IPClaim;
use crds::ip_pool::IPPool;
use crds::boot_profile::BootProfile;
use crds::boot_intent::BootIntent;
use kube::core::CustomResourceExt;

fn main() {
    // Generate CRD YAML for all resources
    let mut crds = Vec::new();
    
    crds.push(IPClaim::crd());
    crds.push(IPPool::crd());
    crds.push(BootProfile::crd());
    crds.push(BootIntent::crd());
    
    // Print header comments
    println!("# This file is auto-generated by crdgen");
    println!("# DO NOT EDIT THIS FILE MANUALLY");
    println!("# If there are malformed YAML issues, fix them in the Rust code (crates/crds/src/)");
    println!("# This file will be overwritten on every code update");
    println!("#");
    
    // Serialize each CRD to YAML
    for crd in crds {
        println!("---");
        match serde_yaml::to_string(&crd) {
            Ok(yaml) => {
                print!("{yaml}");
            }
            Err(e) => {
                eprintln!("Failed to serialize CRD to YAML: {e}");
                std::process::exit(1);
            }
        }
    }
}

